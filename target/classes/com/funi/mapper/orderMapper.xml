<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-/mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="orderMapper">

<insert id="insertData" parameterType="com.funi.domain.OrderDTO"> 
	insert into tlb_order (ordernum,email,imageIndex,amount,orderSum) 
	values (#{ordernum},#{email},#{imageIndex},#{amount},#{orderSum})
</insert>

<!-- 장바구니 전체 금액 -->
<select id="sumMoney" resultType="int">
	select 
		NVL(SUM(price * amount), 0) money 
	form 
		tlb_order o, diningroom d 
	where 
		o.imageIndex=d.imageIndex and o.email=#{email}
</select>

<!-- 장바구니 목록 -->
<select id="listCart" resultType="com.funi.domain.OrderDTO">
	select 
		o.ordernum,
		o.email,
		d.productName,
		m.name,
		o.amount,
		d.price,
		(price*amount) money 
	from
		fumember m, diningroom d, tlb_order o 
	where m.email = o.email 
		and d.imageIndex = o.imageIndex 
		and o.email = #{email} 
	order by
		o.ordernum	
</select>

<!-- 장바구니 수량 수정 -->
<update id="orderUpdateData" >
	update tlb_order set amount=#{amount} where email = #{email} and productName = #{productName}
</update>

<!-- 장바구니 삭제 -->
<delete id="deleteData"> 
	delete from tlb_order where ordernum = #{ordernum}
</delete>

<!-- 장바구니에 동일한 상품레코드 확인 -->
<select id="countCart" resultType="int">
	select count(*) from tlb_order where email = #{email} and productName = #{productName}
</select>

<!-- 장바구니에 동일한 상품이 존재하면 수정 -->
<update id="sumCart" >
	update tlb_order set amount=amount + #{amount} where email = #{email} and productName = #{productName}
</update>


</mapper>